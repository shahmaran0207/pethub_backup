<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>
<div class="min-h-screen flex flex-col">
    <div th:replace="~{header :: header}"></div>
    <main class="flex-1 bg-orange-50">
        <section class="py-16">
            <div class="container mx-auto px-4 md:px-6">
                <div class="max-w-2xl mx-auto">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-center">당신의 계정을 생성하세요!</h1>
                    <p class="text-gray-600 mb-6 text-center">
                        반려동물 애호가들의 활기찬 커뮤니티에 가입하고 독점 혜택을 누려보세요. <br>
                        가입하시면 반려동물에 대한 다양한 정보와 팁을 공유할 수 있으며, <br>
                        다른 애호가들과 소통하며 경험을 나눌 수 있습니다. <br>
                        또한, 회원 전용 이벤트와 할인 혜택을 통해 반려동물 용품을 더 저렴하게 구매할 수 있는 기회를 제공합니다. <br>
                        지금 바로 가입하고, 사랑스러운 반려동물과 함께 더 행복한 일상을 만들어 보세요!
                    </p>
                    <br>
                    <form class="grid gap-6" method="post" name="insert">
                        <div class="grid gap-2">
                            <label
                                    class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                    for="userid"
                            >
                                사용자 아이디
                            </label>
                            <input
                                    class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    id="userid"
                                    placeholder="사용하실 아이디를 입력하세요."
                                    required=""
                                    type="text"
                                    name="userid"
                                    onblur="checkUserId()"
                            />
                            <span id="userid-check"></span>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="userpw"
                                >
                                    사용자 비밀번호
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="userpw"
                                        placeholder="사용하실 비밀번호를 입력하세요"
                                        required=""
                                        type="password"
                                        name="userpw"
                                />
                            </div>
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="pwCheck"
                                >
                                    비밀번호 확인
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="pwCheck"
                                        placeholder="비밀번호를 한번 더 입력하세요."
                                        required=""
                                        type="password"
                                        name="pwCheck"
                                />
                            </div>
                        </div>
                        <div class="grid gap-2">
                            <label
                                    class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                    for="name"
                            >
                                이름
                            </label>
                            <input
                                    class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    id="name"
                                    placeholder="이름을 입력하세요."
                                    required=""
                                    type="text"
                                    name="name"
                            />
                        </div>
                        <div class="grid gap-2">
                            <label
                                    class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                    for="nick"
                            >
                                닉네임
                            </label>
                            <input
                                    class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    id="nick"
                                    placeholder="사용하실 닉네임을 입력하세요."
                                    required=""
                                    type="text"
                                    name="nick"
                            />
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <div class="grid gap-2" style="grid-column: span 2;">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="email"
                                >
                                    이메일
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="email"
                                        placeholder="이메일을 입력하세요."
                                        required=""
                                        type="email"
                                        name="email"
                                />
                            </div>
                            <div class="grid gap-2 items-end">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 block mb-1"
                                        for="auth"
                                ></label>
                                <button
                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-orange-600 text-white hover:bg-orange-500/90 rounded-md"
                                        id="auth"
                                        style="height: 2.5rem;"
                                        type="button"
                                >
                                    인증번호 발송
                                </button>
                            </div>
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="auth_num"
                                >
                                    인증번호
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="auth_num"
                                        placeholder="인증번호를 입력하세요."
                                        required=""
                                        type="text"
                                        name="authNum"
                                        onblur="checkauthNum()"
                                />
                            </div>
                        </div>
                        <span id="auth_num-check"></span>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 block mb-1"
                                        for="zip_code"
                                >
                                    우편번호
                                </label>
                                <input
                                        class="flex h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 w-full"
                                        id="zip_code"
                                        type="text"
                                        placeholder="주소를 검색해주세요."
                                        name="zip_code"
                                        readonly
                                />
                            </div>
                            <div class="grid gap-2 flex items-end">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 block mb-1"
                                        for="search"
                                ></label>
                                <button
                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-orange-600 text-white hover:bg-orange-500/90 rounded-md"
                                        id="search"
                                        style="height: 2.5rem; width: 50%;"
                                        type="button"
                                >
                                    주소 검색하기
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="primary_address"
                                >
                                    도로명 (지번) 주소
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="primary_address"
                                        placeholder="주소를 검색해주세요."
                                        required=""
                                        type="text"
                                        name="primary_address"
                                        readonly
                                />
                            </div>
                            <div class="grid gap-2">
                                <label
                                        class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                        for="address_details"
                                >
                                    상세 주소
                                </label>
                                <input
                                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                        id="address_details"
                                        placeholder="상세주소를 입력해주세요."
                                        required=""
                                        type="text"
                                        name="address_details"
                                />
                            </div>
                        </div>
                        <div class="grid gap-2">
                            <label
                                    class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-gray-900"
                                    for="phone"
                            >
                                휴대폰 번호
                            </label>
                            <input
                                    class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                    id="phone"
                                    placeholder="휴대폰 번호를 입력하세요."
                                    required=""
                                    type="tel"
                                    name="phone"
                            />
                        </div>
                        <div class="flex items-center gap-2">
                            <input
                                    type="checkbox"
                                    id="ad"
                                    value="1"
                                    name="ad"
                                    class="h-4 w-4 rounded-sm border border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                            />
                            <label for="ad"
                                   class="text-sm font-medium leading-none disabled:cursor-not-allowed disabled:opacity-70 text-gray-900 cursor-pointer">
                                광고 수신 동의하기</label>
                        </div>
                        <button
                                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-orange-600 text-white hover:bg-orange-500/90 h-10 px-4 py-2 w-full"
                                type="submit"
                        >
                            계정 생성하기
                        </button>
                        <input type="hidden" id="checkUserIdUrl" th:value="@{/member/checkUserId}"/>
                        <input type="hidden" id="checkAuthNumUrl" th:value="@{/member/checkAuthNumUrl}"/>
                    </form>
                </div>
            </div>
        </section>
    </main>
    <div th:replace="~{footer :: footer}"></div>
</div>
<th:block th:if="${msg != null}">
    <script th:inline="javascript">
        let msg = [[${msg}]];
        alert(msg);
    </script>
</th:block>
<th:block th:if="${row != null}">
    <script th:inline="javascript">
        let row = [[${row}]];
        let msg = "";
        if (row == 1) {
            msg = "회원가입이 정상적으로 완료되었습니다.";
            location.href = "/";
        } else {
            msg = "회원가입에 실패하였습니다."
        }
        alert(msg);
    </script>
</th:block>
<script th:inline="javascript">

    // 아이디 중복확인 비동기
    function checkUserId() {
        var userid = document.getElementById('userid').value;
        var url = document.getElementById('checkUserIdUrl').value;
        if (userid.length > 0) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.exists) {
                        // 중복된 아이디가 있을 경우
                        document.getElementById('userid-check').textContent = '이미 사용 중인 아이디입니다.';
                        document.getElementById('userid-check').style.color = 'red'; // 텍스트 색상을 빨간색으로 변경
                    } else {
                        // 중복된 아이디가 없을 경우
                        document.getElementById('userid-check').textContent = '사용 가능한 아이디입니다.';
                        document.getElementById('userid-check').style.color = 'green'; // 텍스트 색상을 초록색으로 변경
                    }
                } else if (xhr.readyState === 4) {
                    document.getElementById('userid-check').textContent = '아이디 중복 체크 중 오류가 발생했습니다.';
                    document.getElementById('userid-check').style.color = 'red'; // 오류 발생 시 텍스트 색상을 기본값으로 변경
                }
            };
            xhr.send(JSON.stringify({userid: userid}));
        }
    }
    // 인증번호 확인 비동기 표시
    function checkauthNum() {
        console.log('호출');
        var authNum = document.getElementById('auth_num').value;
        var url = document.getElementById('checkAuthNumUrl').value;
        if (authNum.length > 0) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.exists) {
                        // 인증번호가 일치할 경우
                        document.getElementById('auth_num-check').textContent = '인증이 완료되었습니다.';
                        document.getElementById('auth_num-check').style.color = 'green'; // 텍스트 색상을 빨간색으로 변경
                    } else {
                        // 인증번호가 일치하지 않을 경우
                        document.getElementById('auth_num-check').textContent = '인증번호가 일치하지 않습니다.';
                        document.getElementById('auth_num-check').style.color = 'red'; // 텍스트 색상을 초록색으로 변경
                    }
                } else if (xhr.readyState === 4) {
                    document.getElementById('auth_num-check').textContent = '인증 체크 중 오류가 발생했습니다.';
                    document.getElementById('auth_num-check').style.color = 'red'; // 오류 발생 시 텍스트 색상을 기본값으로 변경
                }
            };
            xhr.send(JSON.stringify({authNum: authNum}));
        }
    }

    const search = document.querySelector('#search');
    search.addEventListener("click", () => {
        new daum.Postcode({
            oncomplete: function (data) {
                let fullAddr = '';
                let extraAddr = '';

                if (data.userSelectedType === 'R') {
                    fullAddr = data.roadAddress;
                } else {
                    fullAddr = data.jibunAddress;
                }

                if (data.userSelectedType === 'R') {
                    if (data.bname !== '') {
                        extraAddr += data.bname;
                    }
                    if (data.buildingName !== '') {
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }

                    fullAddr += (extraAddr !== '' ? ' (' + extraAddr + ')' : '');
                }

                document.insert.primary_address.value = fullAddr;
                document.insert.zip_code.value = data.zonecode;
                document.insert.address_details.focus();
            }
        }).open();
    });

    function sendAuthNum(emailFieldId, alertMessage) {
        var email = document.getElementById(emailFieldId).value;
        fetch('/member/AuthNum', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email })
        })
            .then(response => {
                if (response.ok) {
                    alert(alertMessage);
                } else {
                    return response.text(); // 에러 메시지를 텍스트로 받아옴
                }
            })
            .then(errorMessage => {
                if (errorMessage) {
                    alert(errorMessage); // 받아온 에러 메시지를 alert로 표시
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('인증번호 전송에 실패했습니다.');
            });
    }


    document.getElementById('auth').addEventListener('click', function () {
        sendAuthNum('email', '인증번호가 전송되었습니다.');
    });
</script>
</body>
</html>